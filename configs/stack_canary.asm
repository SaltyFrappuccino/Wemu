; Демонстрация обхода защиты стека канарейками

.ORG 0x100

start:
    ; Сначала прочитаем значение канарейки
    LOAD_MEM R0, 0x400    ; Загружаем значение канарейки в R0
    
    ; Имитируем буфер перед канарейкой
    LOAD_IMM R1, 0x390    ; Адрес буфера перед канарейкой
    LOAD_IMM R2, 0x11111111
    STORE_REG R2, 0x390   ; Записываем в буфер
    
    ; Теперь переполняем буфер, но восстанавливаем канарейку
    LOAD_IMM R3, 0x22222222
    STORE_REG R3, 0x398   ; Запись в конец буфера
    STORE_REG R3, 0x39C   ; Переполнение буфера
    
    ; Восстанавливаем значение канарейки
    STORE_REG R0, 0x400   ; Восстанавливаем оригинальное значение канарейки
    
    ; Переписываем адрес возврата после канарейки
    LOAD_IMM R4, 0xC0DE1234
    STORE_REG R4, 0x404   ; Перезаписываем данные после канарейки
    
    HALT 