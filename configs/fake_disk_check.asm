; Демонстрация обхода проверки подлинности диска

.ORG 0x100

start:
    ; Эмуляция проверки ID диска
    ; Предположим, что ID диска хранится в памяти по адресу 0x500
    LOAD_IMM R0, 0x4F524947   ; 'ORIG' (первая часть "ORIGINAL_DISK")
    STORE_REG R0, 0x500
    LOAD_IMM R0, 0x494E414C   ; 'INAL' (вторая часть)
    STORE_REG R0, 0x504
    LOAD_IMM R0, 0x5F444953   ; '_DIS' (третья часть)
    STORE_REG R0, 0x508
    LOAD_IMM R0, 0x4B000000   ; 'K' и нули для выравнивания
    STORE_REG R0, 0x50C
    
    ; Читаем текущий ID диска
    LOAD_MEM R1, 0x500
    LOAD_MEM R2, 0x504
    LOAD_MEM R3, 0x508
    LOAD_MEM R4, 0x50C
    
    ; Проверяем первую часть ID
    LOAD_IMM R5, 0x4F524947   ; Ожидаемое значение 'ORIG'
    CMP_REG R1, R5
    JNE fail_check
    
    ; Если проверка прошла, создаем фиктивную запись в памяти как будто диск подлинный
    LOAD_IMM R0, 0x00000001   ; 1 = диск подлинный
    STORE_REG R0, 0x550       ; Помещаем результат проверки
    JMP success                ; Переходим к успешному завершению
    
fail_check:
    ; Подделываем результат проверки
    LOAD_IMM R0, 0x00000001   ; 1 = диск подлинный (подделка)
    STORE_REG R0, 0x550       ; Перезаписываем результат проверки
    
success:
    ; Читаем результат проверки
    LOAD_MEM R0, 0x550
    LOAD_IMM R1, 0x00000001
    CMP_REG R0, R1           ; Проверяем, что результат = 1
    JNE fail_program         ; Если не 1, завершаем с ошибкой
    
    ; Продолжение программы, если диск "подлинный"
    LOAD_IMM R0, 0xAABBCCDD  ; Код успешной проверки
    STORE_REG R0, 0x600      ; Сохраняем код в памяти
    HALT
    
fail_program:
    LOAD_IMM R0, 0xFFFFFFFF  ; Код ошибки
    STORE_REG R0, 0x600      ; Сохраняем код в памяти
    HALT 