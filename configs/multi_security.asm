; Демонстрация комплексной атаки на несколько модулей безопасности

.ORG 0x100

start:
    ; Шаг 1: Чтение значения канарейки
    LOAD_MEM R0, 0x400    ; Загружаем значение канарейки
    
    ; Шаг 2: Определение смещения ASLR
    ; Создаем характерную сигнатуру
    LOAD_IMM R1, 0xAABBCCDD
    STORE_REG R1, 0x200     ; Сохраняем сигнатуру
    
    ; Шаг 3: Переполнение буфера с обходом канарейки
    ; Запись в буфер
    LOAD_IMM R2, 0x11111111
    STORE_REG R2, 0x300     ; Начало буфера
    
    LOAD_IMM R3, 0x22222222
    STORE_REG R3, 0x308     ; Середина буфера
    
    LOAD_IMM R4, 0x33333333
    STORE_REG R4, 0x310     ; За пределами буфера (переполнение)
    
    ; Восстанавливаем канарейку
    STORE_REG R0, 0x400     ; Возвращаем оригинальное значение канарейки
    
    ; Шаг 4: Инъекция вредоносного кода
    LOAD_IMM R5, 0xDEADC0DE
    STORE_REG R5, 0x500     ; Вредоносный код
    
    ; Шаг 5: Вызов вредоносного кода
    JMP 0x500               ; Переход на вредоносный код
    
    HALT 